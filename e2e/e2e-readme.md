# e2e tests gotchas and caveats

e2e test files are autogenerated by `ng generate`. Initially, those contain a **Jasmine** test suite with a bunch of test cases that will run under **Protractor**.

## Overview 
A test file (*.e2e-spec.ts) initially contains a test suite and several stubbed specs:
```javascript 
describe('this is the suite', () => {
  it('has a spec', () => {
    expect('hi').toBeTruthy('because strings are not falsy');
  });
})
```

<mark>Suites and specs can be nested</mark> to group things according to functionality (see user-management.e2e-spec.ts). 

## Disabling/enabling

To run **a subset** of tests or test cases, add the prefix **f**: 
```javascript 
fdescribe('this is the suite', () => { /* force all specs */ })

fit('has a spec', () => { /* all specs without f will be ignored */ });
```

To **disable** an element, add the prefix **x**: 
```javascript 
xdescribe('this is the suite', () => { /* ignore all specs */ })

xit('has a spec', () => { /* this spec will not be run */ });
```

## Sync/Async 

Any code that is not annotated with the keyboard `async` will be assume as synchronous and should block the calling thread, whereas async functions return a **promise** that will be fulfilled at a later point.
<mark>However,</mark> sync and async does not mix well. 


## Multiple browser instances
In theory, protractor is capable of using multiple browser instances by calling `browser.driver.fork()`. However, since a userdata directory is passed in the configuration file `protractor(-ci)?.conf`, doing this will lead to exceptions at runtime. 

Without the directory, runtime for e2e tests under CI will increase significantly (by a factor >2), so this solution was chosen for performance reasons.  
To re-use the session, selenium-webdriver has to be started separately, which can't be done from inside the .conf-file (presumably?) and needs to run under windows and CI-*nix.
